<template>
  <div class="pages">
<<<<<<< Updated upstream
    <text class="title" style="color:white">您的设备性能得分是：</text>
    <text style="font-size:80px;color:red">{{benchres}}</text>
    <div class="btn" onClick="goback"><text style="font-size:45px">Back</text></div>
    <!-- <div class="back_bottom" @click="goback"><text style="font-size:40px">Nav_Back</text></class></div>
  <div class="home_bottom" @click="goback"><text style="font-size:40px">Nav_Home</text></div>
  <div class="menu_bottom" @click=""><text style="font-size:40px">Nav_Menu</text></div> -->

=======
    <text class="title" style="color: white">您的设备性能得分是(V2)：</text>
    <text style="font-size: 80px; color: red">{{ benchres }}</text>
    <text class="title" style="color: yellow">不同版本测试得分结果不可直接对比</text>
    <div class="btn" onClick="gobackAlternative"><text style="font-size: 35px">Back</text></div>
    <div class="btn" onClick="uploadScore"><text style="font-size: 35px">存储成绩</text></div>
>>>>>>> Stashed changes
  </div>
</template>

<script>
<<<<<<< Updated upstream
import router from "@system.router"
function getOperationsPerSecond() {
      const operations = {
        add: 0,
        subtract: 0,
        multiply: 0,
        divide: 0
      };
    
      const start = new Date().getTime();
    
      while (new Date().getTime() - start < 1000) {
        operations.add++;
        operations.subtract++;
        operations.multiply++;
        operations.divide++;
      }
    
      return operations;
    }
    
    function calculateAverage(operations) {
      const totalOperations = Object.values(operations).reduce((sum, count) => sum + count, 0);
      return totalOperations / Object.keys(operations).length;
    }
    
    const operationsPerSecond = getOperationsPerSecond();
    const averageOperationsPerSecond = calculateAverage(operationsPerSecond);
    

=======
import file from "@system.file"
import router from "@system.router"
import device from "@system.device"
import app from "@system.app"
function getScore() {
  function runTest(iters) {
    var x = 1.1
    for (var i = 0; i < iters; i++) {
      x = x * 0.999 + 0.001
      x = x * 0.998 + 0.002
      x = x * 0.997 + 0.003
      x = x * 0.996 + 0.004
      x = x * 0.995 + 0.005
    }
    return x
  }
>>>>>>> Stashed changes

  var t0 = Date.now()
  var check = runTest(5000)
  var t1 = Date.now()

  var diff = Math.max(t1 - t0, 0.1)

  var targetIters = Math.floor(5000 * (200 / diff))

  targetIters = Math.min(targetIters, 2000000)

  var start = Date.now()
  var finalCheck = runTest(targetIters)
  var end = Date.now()

  var duration = Math.max(end - start, 1)
  var mflops = (targetIters * 10) / (duration / 1000) / 1e6

  return Math.floor(mflops * 200 + finalCheck)
}
var score = getScore() * 4
console.log("设备得分:", score * 4)

function uploadScore() {
  file.writeText({
    uri: "internal://velabench/score.json",
    text:
      '{"type":"' +
      device.getInfo(model) +
      '","version":' +
      app.getInfo(versionCode) +
      '","score":' +
      toString(averageOperationsPerSecond) +
      '"}',
    success: function () {
      console.log("Score saved")
    },
    fail: function (data, code) {
      console.log(`Save failed, code = ${code}`)
    }
  })
}

export default {
  private: {
    text: "运行中",
    benchres: String(score)
  },

<<<<<<< Updated upstream
  goback(){
  router.back({uri:"/pages/index"})
=======
  goback() {
    router.back({uri: "/pages/index"})
  },

  gobackAlternative() {
    router.push({uri: "/pages/index"})
>>>>>>> Stashed changes
  }
}
</script>

<style>
/* .back_bottom{
  display: inline;
  border-radius: 18px;
  width: 105px;
  height: 60px;
  background-color:red;
  color:black;
  position:fixed;
  top:140px;
  right:160px;
}
.home_bottom{
  display: inline;
  border-radius: 18px;
  width: 105px;
  height: 60px;
  background-color:red;
  color:black;
  position:fixed;
  top:80px;
  right:0px;
}
.menu_bottom{
  display: inline;
  border-radius: 18px;
  width: 105px;
  height: 60px;
  background-color:red;
  color:black;
  position:fixed;
  top:20px;
  left:160px; */
.btn {
  width: 180px;
  height: 80px;
  margin-top: 20px;
  border-radius: 40px;
  background-color: #225beb;
  font-size: 5px;
  color: #ffffff;
  justify-content: center;
  align-content: center;
  margin: 20px;
}
.pages {
  background-color: #000000;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.title {
  font-size: 30px;
  text-align: center;
}
</style>
